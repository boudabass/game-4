<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Elsass Frost</title>
    <link rel="stylesheet" href="style.css">

    <!-- 1. LIBRAIRIES -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.4/lib/p5.js"></script>
    <script src="https://p5play.org/v3/planck.min.js"></script>
    <script src="https://p5play.org/v3/p5play.js"></script>

    <!-- 2. SYSTEME -->
    <script>
        window.DyadGame = { id: 'elsass-frost-v1', version: 'v1' };
    </script>
    <!-- On pointe vers le syst√®me parent s'il existe -->
    <script src="../../system/system.js"></script>

    <!-- 3. JEU -->
    <script src="config.js"></script>
    <script src="core/GameState.js"></script>
    <script src="core/SaveManager.js"></script>
    <script src="core/TimeManager.js"></script>
    <script src="core/ResourceManager.js"></script>

    <!-- Syst√®mes -->
    <script src="systems/UIManager.js"></script>
    <script src="systems/GridSystem.js"></script>
    <script src="systems/BuildingSystem.js"></script>
    <script src="systems/InputManager.js"></script>
    <script src="systems/PathfindingSystem.js"></script>
    <script src="systems/Player.js"></script>
    <script src="systems/PlayerSystem.js"></script>

    <script src="main.js"></script>
    <script src="sketch.js"></script>
</head>

<body>
    <!-- √âcran de Chargement -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <h1>Elsass Frost</h1>
            <div id="loading-status">Chargement des ressources...</div>
            <div class="loading-bar-container">
                <div class="loading-progress-track">
                    <div class="loading-progress-fill" id="loading-progress-fill"></div>
                </div>
            </div>
            <button id="play-button" class="hud-btn" style="display: none; margin-top: 20px;"
                onclick="startGame()">COMMENCER</button>
        </div>
    </div>

    <div id="game-container">
        <!-- DEBUG PANEL -->
        <div id="debug-panel" class="debug-panel">
            <div class="debug-header">
                <span>üîß DEBUG MODE</span>
                <button onclick="toggleDebugMenu()">‚ùå</button>
            </div>
            <div class="debug-content">
                <div class="debug-row">
                    <span>CHARBON</span>
                    <button onclick="modifyResource('coal', -100)">-100</button>
                    <button onclick="modifyResource('coal', 100)">+100</button>
                </div>
                <div class="debug-row">
                    <span>BOIS</span>
                    <button onclick="modifyResource('wood', -100)">-100</button>
                    <button onclick="modifyResource('wood', 100)">+100</button>
                </div>
                <div class="debug-row">
                    <span>ACIER</span>
                    <button onclick="modifyResource('iron', -100)">-100</button>
                    <button onclick="modifyResource('iron', 100)">+100</button>
                </div>
                <div class="debug-row">
                    <span>NOYAUX</span>
                    <button onclick="modifyResource('steamCores', -1)">-1</button>
                    <button onclick="modifyResource('steamCores', 1)">+1</button>
                </div>
                <div class="debug-row">
                    <span>CRUS</span>
                    <button onclick="modifyResource('rawFood', -100)">-100</button>
                    <button onclick="modifyResource('rawFood', 100)">+100</button>
                </div>
                <div class="debug-row">
                    <span>RATIONS</span>
                    <button onclick="modifyResource('foodRations', -100)">-100</button>
                    <button onclick="modifyResource('foodRations', 100)">+100</button>
                </div>
                <div class="debug-row">
                    <span>PROTH√àSES</span>
                    <button onclick="modifyResource('prostheses', -1)">-1</button>
                    <button onclick="modifyResource('prostheses', 1)">+1</button>
                </div>
            </div>
        </div>


        <!-- HUD Sup√©rieur Group√© -->
        <div id="top-hud-container" class="top-hud-container">
            <div id="hud-centered-wrapper" class="hud-centered-wrapper">
                <!-- GROUPE GAUCHE : Ressources & Temps -->
                <div id="hud-left-group" class="hud-group-col left-group">
                    <!-- Ligne 1 : Ressources -->
                    <div class="hud-row-item res-row-left">
                        <div class="res-item" title="Charbon">
                            <span class="icon">‚ö´</span>
                            <div class="res-info">
                                <span id="val-coal" class="value">0</span>
                                <span class="label">Charbon</span>
                            </div>
                        </div>
                        <div class="res-item" title="Bois">
                            <span class="icon">ü™µ</span>
                            <div class="res-info">
                                <span id="val-wood" class="value">0</span>
                                <span class="label">Bois</span>
                            </div>
                        </div>
                        <div class="res-item" title="Acier">
                            <span class="icon">üèóÔ∏è</span>
                            <div class="res-info">
                                <span id="val-iron" class="value">0</span>
                                <span class="label">Acier</span>
                            </div>
                        </div>
                        <div class="res-item" title="Noyaux de Vapeur">
                            <span class="icon">üîã</span>
                            <div class="res-info">
                                <span id="val-steamCores" class="value">0</span>
                                <span class="label">Noyaux</span>
                            </div>
                        </div>
                    </div>

                    <!-- Ligne 2 : Temps (Align√© √† droite) -->
                    <div class="hud-row-item time-row-left">
                        <div class="time-controls">
                            <span id="day-counter" class="day-counter">JOUR 1</span>
                            <span id="clock" class="clock">08:00</span>
                            <div class="speed-btns">
                                <button id="speed-0" class="speed-btn" onclick="setSpeed(0)"
                                    title="Pause (Espace)">||</button>
                                <button id="speed-1" class="speed-btn active" onclick="setSpeed(1)"
                                    title="Vitesse 1x">></button>
                                <button id="speed-2" class="speed-btn" onclick="setSpeed(2)"
                                    title="Vitesse 2x">>></button>
                                <button id="speed-3" class="speed-btn" onclick="setSpeed(3)"
                                    title="Vitesse 3x">>>></button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ANCRE CENTRALE : Thermom√®tre -->
                <div id="hud-center-anchor" class="hud-anchor-square">
                    <div id="central-temp-gauge" class="central-temp-gauge">
                        <div class="gauge-inner">
                            <span id="central-temp-val">-20¬∞C</span>
                        </div>
                    </div>
                </div>

                <!-- GROUPE DROITE : Ressources & M√©t√©o -->
                <div id="hud-right-group" class="hud-group-col right-group">
                    <!-- Ligne 1 : Ressources -->
                    <div class="hud-row-item res-row-right">
                        <div class="res-item" title="Nourriture Crue">
                            <span class="icon">ü•©</span>
                            <div class="res-info">
                                <span id="val-rawFood" class="value">0</span>
                                <span class="label">Viande</span>
                            </div>
                        </div>
                        <div class="res-item" title="Rations Alimentaires">
                            <span class="icon">üç≤</span>
                            <div class="res-info">
                                <span id="val-foodRations" class="value">0</span>
                                <span class="label">Plats</span>
                            </div>
                        </div>
                        <div class="res-item" title="Proth√®ses">
                            <span class="icon">ü¶æ</span>
                            <div class="res-info">
                                <span id="val-prostheses" class="value">0</span>
                                <span class="label">Proth√®se</span>
                            </div>
                        </div>
                        <!-- System Split Button -->
                        <div class="res-item system-split-btn">
                            <button class="sys-btn half-btn menu" onclick="toggleMenu()" title="Menu">‚â°</button>
                            <button class="sys-btn half-btn debug" onclick="toggleDebugMenu()" title="Debug">üêû</button>
                        </div>
                    </div>

                    <!-- Ligne 2 : M√©t√©o (Align√© √† gauche) -->
                    <div class="hud-row-item weather-row-right">
                        <div class="forecast-timeline" id="forecast-timeline">
                            <div class="forecast-day" title="Aujourd'hui">-20¬∞C</div>
                            <div class="forecast-day" title="Demain">-20¬∞C</div>
                            <div class="forecast-day" title="Jour 3">-30¬∞C</div>
                            <div class="forecast-day trend-down" title="Chute pr√©vue dans 18h : -40¬∞C">-40¬∞C</div>
                            <div class="forecast-day" title="Jour 5">-40¬∞C</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panneau de Missions (Bas Gauche) -->
        <div id="mission-panel" class="mission-panel">
            <h4 class="mission-header">OBJECTIFS</h4>
            <div id="mission-list">
                <div class="mission-item">
                    <div class="mission-icon-container">
                        <span class="mission-icon">‚ùÑÔ∏è</span>
                    </div>
                    <div class="mission-details">
                        <div class="mission-title">Survivre au froid</div>
                        <div class="mission-condition">Maintenir le G√©n√©rateur actif</div>
                    </div>
                </div>
                <div class="mission-item">
                    <div class="mission-icon-container">
                        <span class="mission-icon">üíî</span>
                    </div>
                    <div class="mission-details">
                        <div class="mission-title">R√©duire les malades</div>
                        <div class="mission-condition">1 / 10</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hub Inf√©rieur : Actions, Jauges et Construction -->
        <div class="bottom-ui-container">
            <!-- Bande de Construction (Masqu√©e par d√©faut) -->
            <div id="build-shelf" class="build-shelf">
                <div class="tabs-row">
                    <button id="tab-all" class="tab-btn active" onclick="UIManager.filterBuildings('all')">TOUT</button>
                    <button id="tab-People" class="tab-btn"
                        onclick="UIManager.filterBuildings('People')">COMMUNAUT√âS</button>
                    <button id="tab-Health" class="tab-btn" onclick="UIManager.filterBuildings('Health')">SANT√â</button>
                    <button id="tab-Food" class="tab-btn"
                        onclick="UIManager.filterBuildings('Food')">NOURRITURE</button>
                    <button id="tab-Coal" class="tab-btn" onclick="UIManager.filterBuildings('Coal')">CHARBON</button>
                    <button id="tab-Wood" class="tab-btn" onclick="UIManager.filterBuildings('Wood')">BOIS</button>
                    <button id="tab-Steel" class="tab-btn" onclick="UIManager.filterBuildings('Steel')">ACIER</button>
                    <button id="tab-Storage" class="tab-btn"
                        onclick="UIManager.filterBuildings('Storage')">STOCKAGE</button>
                    <button id="tab-Tech" class="tab-btn" onclick="UIManager.filterBuildings('Tech')">TECHNIQUE</button>
                    <button id="tab-World" class="tab-btn" onclick="UIManager.filterBuildings('World')">MONDE</button>
                </div>
                <div id="buildings-row-container" class="buildings-row-container">
                    <!-- Actions fixes (Toujours visibles)-->
                    <div id="fixed-build-actions" class="fixed-build-actions">
                        <div class="build-item-container" data-id="road" onclick="UIManager.startBuild('road')">
                            <div class="action-btn-circle sub-btn">
                                <span>üü´</span>
                            </div>
                            <span class="build-label">Road</span>
                        </div>
                        <div class="build-item-container" onclick="BuildingSystem.toggleDemolishMode()">
                            <div id="btn-demolish" class="action-btn-circle sub-btn">
                                <span>‚ùå</span>
                            </div>
                            <span class="build-label">D√©molir</span>
                        </div>
                        <div class="vertical-divider"></div>
                    </div>
                    <!-- B√¢timents d√©filants -->
                    <div id="buildings-row" class="buildings-row scrollable-x">
                        <!-- G√©n√©r√© dynamiquement par UIManager.renderBuildings() -->
                    </div>
                </div>
            </div>

            <!-- Barre d'Action Principale -->
            <div class="bottom-bar">
                <div class="action-group">
                    <div id="btn-tech" class="action-btn-circle" onclick="toggleTech()" title="Recherche">
                        <span>üî¨</span>
                    </div>
                    <div id="btn-build" class="action-btn-circle" onclick="toggleBuildMenu()" title="Construction">
                        <span>üî®</span>
                    </div>
                </div>

                <div class="social-gauges">
                    <div class="gauge-container" title="Espoir">
                        <div id="fill-hope" class="gauge-fill hope" style="width: 50%;"></div>
                        <div class="gauge-label">Espoir</div>
                    </div>
                    <div class="gauge-container" title="M√©contentement">
                        <div id="fill-discontent" class="gauge-fill discontent" style="width: 10%;"></div>
                        <div class="gauge-label">M√©contentement</div>
                    </div>
                </div>

                <div class="action-group">
                    <div id="btn-laws" class="action-btn-circle" onclick="toggleLaws()" title="Lois">
                        <span>‚öñÔ∏è</span>
                    </div>
                    <div id="btn-reports" class="action-btn-circle" onclick="alert('Rapports non impl√©ment√©s')"
                        title="Rapports">
                        <span>üìã</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panneau de D√©tails B√¢timent (C√¥t√© Droit) -->
        <div id="detail-panel" class="detail-panel">
            <div class="detail-header">
                <span id="detail-icon" class="detail-icon">üè†</span>
                <h3 id="detail-name">NOM DU B√ÇTIMENT</h3>
                <button class="close-btn" onclick="UIManager.hideDetailPanel()">‚ùå</button>
            </div>
            <div class="detail-body">
                <p id="detail-desc" class="detail-desc">Description du b√¢timent...</p>
                <div id="detail-stats" class="detail-stats"
                    style="margin-bottom: 10px; font-weight: bold; color: #a5f3fc;"></div>
                <hr>
                <div class="staff-mgmt">
                    <div class="mgmt-row">
                        <span>üë©‚Äçüîß Employ√©s</span>
                        <div class="mgmt-controls">
                            <button onclick="BuildingSystem.modifyStaff(-1)">-</button>
                            <span id="detail-staff-val">0 / 10</span>
                            <button onclick="BuildingSystem.modifyStaff(1)">+</button>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="isolation-info">
                    <span>‚ùÑÔ∏è Isolation :</span>
                    <span id="detail-insulation-val">Niveau 1</span>
                </div>
            </div>
            <div class="detail-footer">
                <button class="hud-btn" onclick="UIManager.movePlayerToCurrent()">VENIR ICI</button>
                <button class="hud-btn dismantle-btn" onclick="BuildingSystem.dismantleCurrent()">D√âMANTELER</button>
            </div>
        </div>
        <!-- Panneau de Validation (Construction / D√©molition) -->
        <div id="action-modal" class="action-modal" style="display: none;">
            <div class="action-header">
                <span id="action-icon" class="action-icon">üèóÔ∏è</span>
                <h3 id="action-title">TITRE ACTION</h3>
            </div>
            <div class="action-body">
                <div id="action-msg">Message d'information...</div>
                <div id="action-cost" class="tooltip-cost"></div>
            </div>
            <div class="action-footer">
                <button id="btn-cancel" class="hud-btn cancel-btn">Annuler</button>
                <button id="btn-confirm" class="hud-btn confirm-btn">Valider</button>
            </div>
        </div>

    </div>

    <script>
        function startGame() {
            document.getElementById('loading-screen').style.display = 'none';
            if (window.GameState) GameState.reset();
        }
    </script>
</body>

</html>